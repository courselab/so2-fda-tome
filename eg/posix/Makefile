#    SPDX-FileCopyrightText: 2021 Monaco F. J. <monaco@usp.br>
#   
#    SPDX-License-Identifier: GPL-3.0-or-later
#
#    This file was generated by SYSeg from a corresponding m4 script.
#    SYSeg is available at https://gitlab.com/monaco/syseg.

init: all 


# Update docm4 files.
#
# These rules are not relevant for the source-code examples in this directory.
# The are provided to automatically update docm4 files when their respective
# sources change. It won't have effect in an exported directory, though.

-include .dist

ifneq (yes,$(DOCM4_DIST))


docm4_deps = ../../tools/docm4.m4 ../../tools/bintools.m4

Makefile : Makefile.m4 $(docm4_deps) 
	@path=$$(pwd) ; dir=$${path##*/};\
	 make -C .. $$dir/Makefile;
	@echo "syseg>>: Makefile has changed: all targets may need to be rebuilt."
	@echo "Building" $$(test -z "$(MAKECMDGOALS)" && echo "the default target" || echo "$(MAKECMDGOALS)")
	@make -f Makefile $(MAKECMDGOALS)

docm4_supported_files = README 

$(docm4_supported_files): % : %.m4 $(docm4_deps)
	@path=$$(pwd) ; dir=$${path##*/}; make -C .. $$dir/$(*) 

updatem4: Makefile
#	@path=$$(pwd) ; dir=$${path##*/}; make -C .. $$(for i in $(docm4_supported_files); do test -f $$dir/$$i.m4 && echo "$$dir/$$i" ; done)
	@make $(docm4_supported_files)

endif

# End of update docm4 files.



##
## Relevant rules
##

CPP_FLAGS = $(CPPFLAGS)
C_FLAGS   = -Wall -Wno-parentheses $(CFLAGS)
LD_FLAGS  = $(LDFLAGS)


bin = getpid fork fork-01 fork-02 exec exec-01 wait loop open redir shell-loop shell-redir shell-pipe shell-job pipe pipeline kill sigaction sigaction-handler ctermid pgid tcpgrp

all: $(bin)

$(bin) : % : %.c
	gcc $(CPP_FLAGS) $(C_FLAGS) $(LD_FLAGS) $< -o $@

exec-01 : loop
kill : CPPFLAGS=-D_GNU_SOURCE
sigaction : CPPFLAGS=-D_GNU_SOURCE
sigaction-handler: CPPFLAGS=-D_GNU_SOURCE



.PHONY: clean

clean :
	rm -f *.o $(bin)
	rm -f *~


